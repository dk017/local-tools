services:
  # Python Backend Service
  backend:
    build:
      context: ./python-backend
    container_name: tools-backend
    restart: unless-stopped
    environment:
      - PORT=8000
      # CORS Configuration - Set to your production domain(s)
      # For same-origin (nginx proxy), you can use the frontend service name
      # Or set to specific domain: CORS_ORIGINS=http://yourdomain.com,https://yourdomain.com
      - CORS_ORIGINS=http://localhost
      # File size limits (in bytes)
      - MAX_FILE_SIZE=52428800
      - MAX_TOTAL_SIZE=104857600
      # LemonSqueezy API (for subscription validation)
      - LEMONSQUEEZY_API_KEY=${LEMONSQUEEZY_API_KEY}
      - BACKEND_URL=http://backend:8000
    tmpfs:
      - /tmp/offline_tools_api

  # Frontend Service (Nginx)
  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
    container_name: tools-frontend
    restart: unless-stopped
    ports:
      - "80:80"
    depends_on:
      - backend
    environment:
      # LemonSqueezy Checkout (Public - safe to expose)
      - NEXT_PUBLIC_LEMONSQUEEZY_STORE=${NEXT_PUBLIC_LEMONSQUEEZY_STORE}
      - NEXT_PUBLIC_LEMONSQUEEZY_VARIANT_ID=${NEXT_PUBLIC_LEMONSQUEEZY_VARIANT_ID}
      # LemonSqueezy Webhook (Server-side only)
      - LEMONSQUEEZY_WEBHOOK_SECRET=${LEMONSQUEEZY_WEBHOOK_SECRET}
